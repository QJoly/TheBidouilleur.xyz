"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7904],{4137:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(r),d=a,f=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return r?n.createElement(f,s(s({ref:t},u),{},{components:r})):n.createElement(f,s({ref:t},u))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[c]="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=r[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5297:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=r(7462),a=(r(7294),r(4137));const i={title:"Traefik Certs Dumper",slug:"traefik-cert-dumper",description:"Extraire les certificats SSL/TLS de Traefik avec Traefik-Certs-Dumper pour les utiliser dans d'autres applications"},s=void 0,o={unversionedId:"Adminsys/traefik-cert-dumper",id:"Adminsys/traefik-cert-dumper",title:"Traefik Certs Dumper",description:"Extraire les certificats SSL/TLS de Traefik avec Traefik-Certs-Dumper pour les utiliser dans d'autres applications",source:"@site/docs/Adminsys/traefik-cert-dumper.md",sourceDirName:"Adminsys",slug:"/Adminsys/traefik-cert-dumper",permalink:"/TheBidouilleur.xyz/en/docs/Adminsys/traefik-cert-dumper",draft:!1,editUrl:"https://github.com/QJoly/TheBidouilleur.xyz/tree/main/docs/Adminsys/traefik-cert-dumper.md",tags:[],version:"current",lastUpdatedAt:1688743185,formattedLastUpdatedAt:"Jul 7, 2023",frontMatter:{title:"Traefik Certs Dumper",slug:"traefik-cert-dumper",description:"Extraire les certificats SSL/TLS de Traefik avec Traefik-Certs-Dumper pour les utiliser dans d'autres applications"},sidebar:"tutorialSidebar",previous:{title:"V\xe9rification configuration syst\xe8me (testinfra)",permalink:"/TheBidouilleur.xyz/en/docs/Adminsys/testinfra"},next:{title:"Exposer vos conteneurs sans NAT avec Cloudflared",permalink:"/TheBidouilleur.xyz/en/docs/Home/cloudflared"}},l={},p=[{value:"Installation",id:"installation",level:2},{value:"Utilisation",id:"utilisation",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...r}=e;return(0,a.kt)(c,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Traefik est un reverse proxy et load balancer populaire pour les environnements de conteneurs, il est tr\xe8s utilis\xe9 pour ses fonctionnalit\xe9s d'automatisation et de configuration dynamique. Celui-ci va cr\xe9er automatiquement les redirections et les certificats SSL/TLS pour vos applications Web. (via des labels Docker ou des manifests Kubernetes)"),(0,a.kt)("p",null,"Ainsi, Traefik a su s'imposer comme un outil incontournable pour les environnements de conteneurs, et il est utilis\xe9 par de nombreuses entreprises et chaque version rajoute de nouvelles int\xe9grations ",(0,a.kt)("em",{parentName:"p"},"(Consul, Etcd, ECS, Nomad, Redis)"),"."),(0,a.kt)("p",null,"Par d\xe9faut Traefik utilise Let's Encrypt pour g\xe9n\xe9rer ",(0,a.kt)("em",{parentName:"p"},"(et renouveler)")," les certificats SSL/TLS en les stockant dans un fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"acme.json")," ",(0,a.kt)("em",{parentName:"p"},"(Il me semble qu'il est possible d'enregistrer les certificats dans Consul, mais nous n'en parlerons pas dans cette page)")),(0,a.kt)("p",null,"Cependant, il n'est pas toujours \xe9vident de r\xe9cup\xe9rer les certificats g\xe9n\xe9r\xe9s par Traefik, et il n'existe pas de commande pour les exporter ",(0,a.kt)("em",{parentName:"p"},"(\xe0 ma connaissance)"),". C'est pour cette raison que je me suis tourn\xe9 vers Traefik Certs Dumper. C'est un projet open source disponible sur GitHub qui a \xe9t\xe9 cr\xe9\xe9 par ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ldez"},"ldez")," ",(0,a.kt)("em",{parentName:"p"},"(Fran\xe7ais, \xe7a vaut la peine de le pr\xe9ciser)"),".\nIl s'agit d'un outil sp\xe9cifiquement con\xe7u pour exporter les certificats SSL/TLS \xe0 partir du fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"acme.json"),"."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Pourquoi extraire les certificats SSL/TLS de Traefik ?")),(0,a.kt)("p",null,"Parce que mon serveur Mail utilise un certificat SSL/TLS valide pour envoyer des emails, et que je ne voulais pas utiliser un certificat auto-sign\xe9 en sachant que certaines applications refusent de se connecter \xe0 un serveur SMTP qui utilise un certificat auto-sign\xe9."),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"Traefik Cert Dumper dispose d'un paquet NixOS, il est donc possible de l'installer avec la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"nix-env -iA traefik-certs-dumper # Installation r\xe9elle\nnix-shell -p traefik-certs-dumper # Installation \xe9ph\xe9m\xe8re\n")),(0,a.kt)("p",null,"Sinon, vous pouvez tr\xe8s bien t\xe9l\xe9charger le binaire depuis la page de ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ldez/traefik-certs-dumper/releases"},"releases"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://github.com/ldez/traefik-certs-dumper/releases/download/v2.8.1/traefik-certs-dumper_v2.8.1_linux_amd64.tar.gz\ntar xvfz traefik-certs-dumper_v2.8.1_linux_amd64.tar.gz\n")),(0,a.kt)("h2",{id:"utilisation"},"Utilisation"),(0,a.kt)("p",null,"Mon objectif est d'extraire les certificats SSL/TLS pour mon serveur Mail, qui est accessible via le sous-domaine ",(0,a.kt)("inlineCode",{parentName:"p"},"mail.example.com"),". Pour cela, je vais r\xe9cup\xe9rer mon fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"acme.json")," et le placer dans le dossier ",(0,a.kt)("inlineCode",{parentName:"p"},"/tmp")," ",(0,a.kt)("em",{parentName:"p"},"(pour l'exemple)"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl -n kube-system cp traefik-78485558bc-zbj2s:/data/acme.json /tmp/acme.json\n")),(0,a.kt)("p",null,"Pour extraire les fichiers au format ",(0,a.kt)("inlineCode",{parentName:"p"},"privkey.pem")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"fullchain.pem")," il suffit d'ex\xe9cuter la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"traefik-certs-dumper file --domain-subdir --crt-ext=.pem --key-ext=.pem --version v2\n")),(0,a.kt)("p",null,"Nous nous retrouvons alors avec un dossier ",(0,a.kt)("inlineCode",{parentName:"p"},"dump")," dans lequel se trouvent les fichiers ",(0,a.kt)("inlineCode",{parentName:"p"},"privkey.pem")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"fullchain.pem")," pour chaque sous-domaine."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"drwxr-xr-x  2 root root 4,0K 27 juin  09:27 site.example.com\ndrwxr-xr-x  2 root root 4,0K 27 juin  09:27 mail.example.com\ndrwxr-xr-x  2 root root 4,0K 27 juin  09:27 blog.example.com\n")),(0,a.kt)("p",null,"Dans chaque sous-dossier, le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"certificate.pem")," correspond au ",(0,a.kt)("inlineCode",{parentName:"p"},"fullchain.pem")," et le fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"privatekey.pem")," correspond au ",(0,a.kt)("inlineCode",{parentName:"p"},"privkey.pem"),"."),(0,a.kt)("p",null,"\xc0 partir de l\xe0, il est possible de copier les fichiers et de s'en servir pour d'autres applications."))}m.isMDXComponent=!0}}]);
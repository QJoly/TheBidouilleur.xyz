"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7668],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),s=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=s(n),m=a,b=c["".concat(o,".").concat(m)]||c[m]||d[m]||l;return n?r.createElement(b,p(p({ref:t},u),{},{components:n})):r.createElement(b,p({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,p=new Array(l);p[0]=c;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,p[1]=i;for(var s=2;s<l;s++)p[s]=n[s];return r.createElement.apply(null,p)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2380:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>p,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>s});var r=n(7462),a=(n(7294),n(3905));const l={slug:"creer-repo-debian",title:"Cr\xe9er son d\xe9pot Debian",tags:["debian","infra"]},p=void 0,i={unversionedId:"AdminSys/creer-repo-debian",id:"AdminSys/creer-repo-debian",title:"Cr\xe9er son d\xe9pot Debian",description:"Cette page n\u2019est pas termin\xe9e, attention aux informations qui peuvent s\u2019y trouver.",source:"@site/docs/AdminSys/creer-repo-debian.md",sourceDirName:"AdminSys",slug:"/AdminSys/creer-repo-debian",permalink:"/TheBidouilleur.xyz/en/docs/AdminSys/creer-repo-debian",draft:!1,editUrl:"https://github.com/QJoly/TheBidouilleur.xyz/tree/main/docs/AdminSys/creer-repo-debian.md",tags:[{label:"debian",permalink:"/TheBidouilleur.xyz/en/docs/tags/debian"},{label:"infra",permalink:"/TheBidouilleur.xyz/en/docs/tags/infra"}],version:"current",frontMatter:{slug:"creer-repo-debian",title:"Cr\xe9er son d\xe9pot Debian",tags:["debian","infra"]},sidebar:"tutorialSidebar",previous:{title:"Cr\xe9er ses propres packages Debian",permalink:"/TheBidouilleur.xyz/en/docs/AdminSys/creer-deb"},next:{title:"Boot PXE simplifi\xe9 avec netboot",permalink:"/TheBidouilleur.xyz/en/docs/AdminSys/netbootxyz"}},o={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Qu\u2019est-ce qu\u2019Aptly ?",id:"quest-ce-quaptly-",level:2},{value:"G\xe9n\xe9ration Couple GPG (Optionnel)",id:"g\xe9n\xe9ration-couple-gpg-optionnel",level:2},{value:"Installer Aptly",id:"installer-aptly",level:2},{value:"Cr\xe9er votre d\xe9p\xf4t priv\xe9",id:"cr\xe9er-votre-d\xe9p\xf4t-priv\xe9",level:2}],u={toc:s};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{title:"En cours d\u2019\xe9criture",type:"danger"},(0,a.kt)("p",{parentName:"admonition"},"Cette page n\u2019est pas termin\xe9e, attention aux informations qui peuvent s\u2019y trouver.")),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Debian est la distribution la plus utilis\xe9e et connue. En tant que Workstation ",(0,a.kt)("em",{parentName:"p"},"(Via Ubuntu Desktop)")," ou en serveur, nous n\u2019avons de cesse d\u2019utiliser Debian dans notre quotidien. Et si Debian est si forte, c\u2019est avant-tout gr\xe2ce au nombre de personnes qui s\u2019en servent et font vivre la suite de logiciels disponibles sur cette distribution."),(0,a.kt)("p",null,"Et si installer un programme se fait facilement via les fichiers ",(0,a.kt)("inlineCode",{parentName:"p"},".deb"),", l\u2019usage d\u2019un d\xe9p\xf4t ",(0,a.kt)("em",{parentName:"p"},"(centralisant ces ",(0,a.kt)("inlineCode",{parentName:"em"},".deb"),")")," devient une n\xe9cessit\xe9 lorsque l\u2019on doit administrer un grand nombreux de machines."),(0,a.kt)("h2",{id:"quest-ce-quaptly-"},"Qu\u2019est-ce qu\u2019Aptly ?"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Aptly")," est un programme permet de cr\xe9er et g\xe9rer un d\xe9p\xf4t de paquet. Celui-ci est tr\xe8s souple et permet notamment de faire un ",(0,a.kt)("em",{parentName:"p"},"miroir")," \xe0 partir d\u2019un autre d\xe9p\xf4t. "),(0,a.kt)("p",null,"Le fonctionnement de Aptly est ",(0,a.kt)("em",{parentName:"p"},"simple"),", nous ajoutons un d\xe9p\xf4t ",(0,a.kt)("em",{parentName:"p"},"(Miroir, ou local)"),", nous importons des fichiers ",(0,a.kt)("inlineCode",{parentName:"p"},"deb")," si le d\xe9p\xf4t est local, nous cr\xe9ons une snapshot, et nous la publions sur un serveur web."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://www.aptly.info/img/schema.png",alt:"Schema"})),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Oui, \xe7a fait beaucoup d\u2019\xe9tapes, mais ne vous inqui\xe9tez pas : celles-ci sont assez faciles \xe0 r\xe9aliser.")),(0,a.kt)("h2",{id:"g\xe9n\xe9ration-couple-gpg-optionnel"},"G\xe9n\xe9ration Couple GPG (Optionnel)"),(0,a.kt)("p",null,"Par s\xe9curit\xe9, je vous invite \xe0 cr\xe9er un couple de cl\xe9 ",(0,a.kt)("em",{parentName:"p"},"gpg"),", qui sera utilis\xe9 pour signer votre d\xe9p\xf4t et emp\xeacher une quelconque attaque ",(0,a.kt)("em",{parentName:"p"},"MITM"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"gpg --full-generate-key # Laissez les choix par d\xe9faut\n")),(0,a.kt)("p",null,"Je vous conseille vivement de sauvegarder le mot de passe de la cl\xe9 ",(0,a.kt)("em",{parentName:"p"},"(Et \xe0 ce qu\u2019il soit s\xe9curis\xe9, ex: ",(0,a.kt)("inlineCode",{parentName:"em"},"mimbko2v59MAPu;qM2HX!YdN7ioMT"),")"),". Celui-ci ne sera pas r\xe9cup\xe9rable si vous le perdez."),(0,a.kt)("p",null,"Les cl\xe9s cr\xe9\xe9es sont accessibles de cette mani\xe8re : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# gpg --list-keys\n/root/.gnupg/pubring.kbx\n------------------------\npub   rsa3072 2023-02-11 [SC]\n      2DB7FDA5442C053973F9F3CAB55A4CDD19C23946\nuid          [  ultime ] Quentin JOLY (Aptly Repo) <github@thoughtless.eu>\nsub   rsa3072 2023-02-11 [E]\n")),(0,a.kt)("p",null,"Vous pouvez exporter la cl\xe9 pour la placer dans le ",(0,a.kt)("em",{parentName:"p"},"futur")," site cr\xe9\xe9 par Aptly, vos utilisateurs vous remercieront plus tard."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p ~/.aptly/public/\ngpg --armor --output ~/.aptly/data/public/gpg --export 2DB7FDA5442C053973F9F3CAB55A4CDD19C23946\n")),(0,a.kt)("h2",{id:"installer-aptly"},"Installer Aptly"),(0,a.kt)("p",null,"Pour installer Aptly, je vous invite \xe0 t\xe9l\xe9charger le binaire et \xe0 le placer dans votre ",(0,a.kt)("inlineCode",{parentName:"p"},"PATH"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd /tmp \\\n      && wget -q -O - https://github.com/aptly-dev/aptly/releases/download/v1.5.0/aptly_1.5.0_linux_amd64.tar.gz | tar xvzf - \\\n      && mv aptly_1.5.0_linux_amd64/aptly /usr/bin/aptly\n")),(0,a.kt)("h2",{id:"cr\xe9er-votre-d\xe9p\xf4t-priv\xe9"},"Cr\xe9er votre d\xe9p\xf4t priv\xe9"),(0,a.kt)("p",null,"Via ",(0,a.kt)("a",{parentName:"p",href:"./creer-deb"},"cette documentation"),", nous avons appris \xe0 cr\xe9er nos propres ",(0,a.kt)("inlineCode",{parentName:"p"},"deb"),". J\u2019ai donc cr\xe9\xe9 quelques paquets ",(0,a.kt)("em",{parentName:"p"},"exemple")," \xe0 stocker dans 2 d\xe9p\xf4ts diff\xe9rents : ",(0,a.kt)("em",{parentName:"p"},"stable et unstable"),"."),(0,a.kt)("p",null,"Voici mon architecture :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 stable\n\u2502\xa0\xa0 \u2514\u2500\u2500 kompose_1.28.0-1_amd64.deb\n\u2514\u2500\u2500 unstable\n    \u251c\u2500\u2500 foobar_1-1_all.deb\n    \u251c\u2500\u2500 hello-world_1-1_amd64.deb\n    \u2514\u2500\u2500 hello-world_1-1_arm64.deb\n")),(0,a.kt)("p",null,"*le paquet Hello-World est "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'aptly repo create unstable \naptly repo add unstable unstable/\naptly snapshot create unstable from repo unstable\naptly publish snapshot -architectures="amd64,arm64" -distribution="unstable" -gpg-key="2DB7FDA5442C053973F9F3CAB55A4CDD19C23946" unstable\n---\naptly publish drop unstable\naptly snapshot drop unstable\naptly repo drop unstable\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'aptly repo create stable\naptly repo add stable stable/\naptly snapshot create stable from repo stable\naptly publish snapshot -architectures="amd64,arm64" -distribution="stable" -gpg-key="2DB7FDA5442C053973F9F3CAB55A4CDD19C23946" stable \n---\naptly publish drop stable\naptly snapshot drop stable\naptly repo drop stable\n')),(0,a.kt)("p",null,"wget -O - -q ",(0,a.kt)("a",{parentName:"p",href:"http://192.168.1.102:8080/gpg"},"http://192.168.1.102:8080/gpg")," | sudo apt-key add -\nsudo apt install hello-world"))}d.isMDXComponent=!0}}]);
<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">One post tagged with &quot;containers&quot; | TheBidouilleur</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://thebidouilleur.xyz/TheBidouilleur.xyz/en/img/BMO.png"><meta data-rh="true" name="twitter:image" content="https://thebidouilleur.xyz/TheBidouilleur.xyz/en/img/BMO.png"><meta data-rh="true" property="og:url" content="https://thebidouilleur.xyz/TheBidouilleur.xyz/en/blog/tags/containers"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" property="og:title" content="One post tagged with &quot;containers&quot; | TheBidouilleur"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/TheBidouilleur.xyz/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://thebidouilleur.xyz/TheBidouilleur.xyz/en/blog/tags/containers"><link data-rh="true" rel="alternate" href="https://thebidouilleur.xyz/TheBidouilleur.xyz/en/blog/tags/containers" hreflang="en"><link data-rh="true" rel="alternate" href="https://thebidouilleur.xyz/TheBidouilleur.xyz/blog/tags/containers" hreflang="fr"><link data-rh="true" rel="alternate" href="https://thebidouilleur.xyz/TheBidouilleur.xyz/blog/tags/containers" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/TheBidouilleur.xyz/en/blog/rss.xml" title="TheBidouilleur RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/TheBidouilleur.xyz/en/blog/atom.xml" title="TheBidouilleur Atom Feed">



<script src="https://stats.192168128.xyz/js/script.js" defer="defer" data-domain="thebidouilleur.xyz"></script><link rel="stylesheet" href="/TheBidouilleur.xyz/en/assets/css/styles.55be8588.css">
<link rel="preload" href="/TheBidouilleur.xyz/en/assets/js/runtime~main.968c38df.js" as="script">
<link rel="preload" href="/TheBidouilleur.xyz/en/assets/js/main.1306f0ac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/TheBidouilleur.xyz/en/"><div class="navbar__logo"><img src="/TheBidouilleur.xyz/en/img/BMO.svg" alt="TheBidouilleur" class="themedImage_ToTc themedImage--light_HNdA"><img src="/TheBidouilleur.xyz/en/img/BMO.svg" alt="TheBidouilleur" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">TheBidouilleur</b></a><a class="navbar__item navbar__link" href="/TheBidouilleur.xyz/en/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/TheBidouilleur.xyz/en/blog">Blog</a><a href="https://github.com/qjoly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Git<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/TheBidouilleur.xyz/en/blog/tags/containers" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/TheBidouilleur.xyz/blog/tags/containers" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="fr">Français</a></li></ul></div><a class="navbar__item navbar__link" href="/TheBidouilleur.xyz/en/blog/archive">Archives</a><a href="https://twitter.com/thebidouilleur" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/Mon-Setup">Mon matériel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/Creer-son-registre-helm">Créer son propre registre helm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/kubernetes-hcl">Kubernetes in HCL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/cluster-maj">Keep your clusters up-to-date</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/remarkable">Remarkable, a step forward in note taking</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/nixos">NixOS, Ma nouvelle distribution</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/gyroroue">Mes débuts à la gyroroue</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/longhorn">Longhorn, stockage distribué</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/s3contabo">Mes débuts avec s3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/presentation-packer">Quick Presentation of Packer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/loki-grafana">Utilisation de Loki pour Centraliser les logs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/caddy">Too many loadbalancers</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/TheBidouilleur.xyz/en/blog/presentation-docker-swarm">Quick presentation of Docker Swarm</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;containers&quot;</h1><a href="/TheBidouilleur.xyz/en/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/TheBidouilleur.xyz/en/blog/presentation-docker-swarm">Quick presentation of Docker Swarm</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-06-29T00:00:00.000Z" itemprop="datePublished">June 29, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://git.thoughtless.eu" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/82603435?v=4" alt="TheBidouilleur"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://git.thoughtless.eu" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">TheBidouilleur</span></a></div><small class="avatar__subtitle" itemprop="description">Adorateur de trucs merdiques</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>[ This article is from my old-blog, it will also be available in the &quot;Documentation&quot; section of the site ]</p><h1>Docker Swarm</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>The world of containerization has brought many things into system administration, and has updated the concept of DevOps. But one of the main things that containers (and especially Docker) bring us is <strong>automation</strong>.</p><p>And although Docker is already complete with service deployment, we can go a little further by automating container management! And to answer that: <em>Docker Inc.</em> offers a tool suitable for automatic instance orchestration: <strong>Docker Swarm</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-docker-swarm">What is Docker Swarm?<a href="#what-is-docker-swarm" class="hash-link" aria-label="Direct link to What is Docker Swarm?" title="Direct link to What is Docker Swarm?">​</a></h2><p>As previously stated: Docker Swarm is an orchestration tool. With this tool, we can automatically manage our containers with rules favoring High-availability, and Scalability of your services.
We can therefore imagine two scenarios that are entirely compatible:</p><ul><li>Your site has a peak load and requires several containers: Docker Swarm manages replication and load balancing</li><li>A machine hosting your Dockers is down: Docker Swarm replicates your containers on other machines.</li></ul><p>So we&#x27;ll see how to configure that, and take a little look at the state of play of the features on offer.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-swarm-cluster">Create Swarm Cluster<a href="#create-swarm-cluster" class="hash-link" aria-label="Direct link to Create Swarm Cluster" title="Direct link to Create Swarm Cluster">​</a></h2><p><em>For testing, I will use PWD (Play With Docker) to avoid mounting this on my infra</em>:)</p><p>So I have 4 machines under <strong>Alpine</strong> on which I will start a Swarm cluster.
<img loading="lazy" src="https://i.imgur.com/7mD3suS.png" class="img_ev3q"></p><p>The first step is to define a Manager, this will be the head of the cluster, as well as the access points to the different machines.
In our case, we will make it very simple, the manager will be <strong>Node1</strong>.</p><p>To start the Swarm on the manager, simply use the &#x27;docker swarm init&#x27; command.
<strong>But</strong>, if your system has a network card count greater than 1 <em>(Fairly easy on a server)</em>, you must give the listening IP.
In my case, the LAN interface IP (where VMs communicate) is <em>192.168.0.8</em>.
So the command I&#x27;m going to run is</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> swarm init èèadvertise-addr </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Docker says:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Swarm initialized: current node (cdbgbq3q4jp1e6espusj48qm3) is now a manager.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To add a worker to this swarm, run the following command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker swarm join —token SWMTKN-1-5od5zuquln0kgkxpjybvcd45pctp4cp0l12srhdqe178ly8s2m-046hmuczuim8oddmk08gjd1fp 192.168.0.8:2377</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In summary: The cluster is well started, and it gives us the exact command to join the cluster from other machines!
Since Node1 is the manager, I just need to run the docker swarm join command on Node2-4.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> swarm </span><span class="token function" style="color:#d73a49">join</span><span class="token plain"> --token SWMTKN-1-5od5zuquln0kgkxpjybvcd45pctp4cp0l12srhdqe178ly8s2m-046hmuczuim8oddmk08gjd1fp </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.8:2377</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once completed, you can view the result on the <em>manager</em> with the command &#x27;docker node ls&#x27;
<img loading="lazy" src="https://i.imgur.com/2rgU3wm.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-a-simple-service">Deploy a simple service<a href="#deploy-a-simple-service" class="hash-link" aria-label="Direct link to Deploy a simple service" title="Direct link to Deploy a simple service">​</a></h2><p>If you are a docker run user and you refuse docker-compose, you should know one thing: i don&#x27;t like you.
As you are nice to me, here is a piece of information that won&#x27;t help: the equivalent of &#x27;docker run&#x27; in Swarm is &#x27;docker service&#x27;. But we&#x27;re not going to get into that in this article.</p><p>Instead, we will use the docker-composed equivalent, which is the docker stack.
So first of all, here&#x27;s the .yml file</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">viz</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dockersamples/visualizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8080:8080&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">placement</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> node.role == manager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Before you start it, you&#x27;ll probably notice the <strong>deploy</strong> part that lets you give directions to Swarm. So we can add constraints to deploy this on the manager(s), ask the host to limit the use of resources, or manage replicas for load balancing.</p><p>This first container will be used to have a simple dashboard to see where the Dashboards are positioned, and avoid going to CLI only for this function.</p><p>We will deploy this compose with the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> stack deploy —compose-file docker-compose.yml swarm-visualize</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the command is complete, you simply open the manager&#x27;s web server at port 8080.
<img loading="lazy" src="https://i.imgur.com/sVKKmtj.png" class="img_ev3q"></p><p>So we now have a web panel to track container updates.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="simplified-management-of-replicas">Simplified management of replicas<a href="#simplified-management-of-replicas" class="hash-link" aria-label="Direct link to Simplified management of replicas" title="Direct link to Simplified management of replicas">​</a></h2><p>When you access a container, you must go through the manager. But there is nothing to prevent being redirected to the 3-4 node via the manager. This is why it is possible to distribute the load balancing with a system similar to HAProxy, i.e. by redirecting users to a different container each time a page is loaded.</p><p>Here is a docker-compose automatically creating replicas:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hello-world</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;80:8000&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> crccheck/hello</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the result is surprising:
<img loading="lazy" src="https://i.imgur.com/27a7V2i.png" class="img_ev3q"></p><p>We can also adjust the number of replica.
By decreasing it:</p><p><code>docker service scale hello-world_hello-world=2</code></p><p><img loading="lazy" src="https://i.imgur.com/pf4Y1ih.png" class="img_ev3q"></p><p>Or by increasing it:</p><p><code>docker service scale hello-world_hello-world=20</code></p><p><img loading="lazy" src="https://i.imgur.com/MW5uUOq.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-about-high-availability">What about High Availability?<a href="#what-about-high-availability" class="hash-link" aria-label="Direct link to What about High Availability?" title="Direct link to What about High Availability?">​</a></h2><p>I focused this article on the functions of Swarm, and how to use them. And if I did not address this item first, it is because every container created in this post is managed in HA!
For example, I will forcibly stop the 10th replica of the &quot;Hello world&quot; container, which is on <strong>Node1</strong>. And this one will be directly revived,
<img loading="lazy" src="https://i.imgur.com/7Ni9NNG.png" class="img_ev3q"></p><blockquote><p>Okay, But docker could already automatically restart containers in case of problem, how is swarm different?</p></blockquote><p>And to answer that, I&#x27;m going to stop the <strong>node4</strong>
<img loading="lazy" src="https://i.imgur.com/ejkzT7a.png" class="img_ev3q"></p><p>It is noted that the other nodes distribute automatically (and without any intervention) the stopped containers. And since we only access services through managers, they will only redirect to the containers that are started.
One of the servers can therefore catch fire, the service will always be redundant, balanced, and accessible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>Docker-Swarm is a gateway to application clusters that are incredibly complex without a suitable tool. Swarm is easy to meet special needs without any technical expertise.
In a production environment, it is advisable to switch to Kubernetes or Nomad which are much more complete and powerful alternatives.</p><p>I encourage you to try this kind of technology that will govern our world of tomorrow!</p><p>Thanks for reading</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/TheBidouilleur.xyz/en/blog/tags/docker">docker</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/TheBidouilleur.xyz/en/blog/tags/swarm">swarm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/TheBidouilleur.xyz/en/blog/tags/containers">containers</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/TheBidouilleur.xyz/en/blog/tags/cluster">cluster</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TheBidouilleur.xyz/en/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Me Suivre</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/TheBidouilleur" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://thebidouilleur.xyz/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item">Flux RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/TheBidouilleur.xyz/en/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/TheBidouilleur.xyz/en/blog/archive">Archives</a></li><li class="footer__item"><a href="https://github.com/qjoly" target="_blank" rel="noopener noreferrer" class="footer__link-item">Git<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 TheBidouilleur.</div></div></div></footer></div>
<script src="/TheBidouilleur.xyz/en/assets/js/runtime~main.968c38df.js"></script>
<script src="/TheBidouilleur.xyz/en/assets/js/main.1306f0ac.js"></script>
</body>
</html>